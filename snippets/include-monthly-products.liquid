{% comment %}
  Snippet can be used in section or block
  eg. {% include 'include-featured-product' %}
{% endcomment %}

{% comment %}Assign object as block or section{% endcomment %}
{% if type == 'block' %}
  {% assign object = block %}
{% else %}
  {% assign object = section %}
{% endif %}

{% assign id = object.id %}
{% assign featured_product = object.settings.featured_product %}

{%- assign product = all_products[featured_product] -%}
{% assign product_tags = product.tags | join: ' ' %}

{% unless collection_handles contains 'coming-soon' %}
  {% assign variant = product.selected_or_first_available_variant %}
{% endunless %}

{%- assign collection_handles = product.collections | map: 'handle' -%}
{% if product.empty? %}
  {%- assign section_onboarding = true -%}
{% else %}
  {%- assign section_onboarding = false -%}
{% endif %}

{% include 'product__structured-data' %}

      <div class="container
                block-{{ object.id }}
                product 
                one-third
                medium-down--one-whole
                product_section
                js-product_section
                is-justify-space-between
                data-rv-handle="{{ product.handle }}">
                
        {% comment %} Product gallery {% endcomment %}
        <div class="column">
          <div class="top_badge">
            {% if collection_handles contains 'best-seller' %}
              <p>{{ 'collections.general.best_seller' | t }}</p>
            {% endif %}
          </div>

          <div classs="product-title-top">
            <h2 class="title-top">{{ object.settings.product_heading }}</h2>
          </div>

          {% comment %} Price {% endcomment %}
          <p class="modal_price subtitle">
            {% if collection_handles contains 'coming-soon' %}
              {% if settings.stickers_enabled == false %}
                {{ 'collections.general.coming_soon' | t }}
              {% endif %}
            {% else %}
  
              {% comment %} Sold out {% endcomment %}
              <span class="sold_out">{% if variant.available == false %}{{ 'products.product.sold_out' | t }}{% endif %}</span>
  
              {% comment %} Current price {% endcomment %}
              <span content="{{ variant.price | money_without_currency | remove: "," }}" class="{% if variant.compare_at_price > variant.price %}sale{% endif %}">
                <span class="current_price {% if product.available == false %}hidden{% endif %}">
                  {% if variant.price > 0 %}
                    <span class="money">{{ variant.price | money }}</span>
                  {% else %}
                    {{ settings.free_price_text }}
                  {% endif %}
                </span>
              </span>
  
              {% comment %} Compare at (original) price {% endcomment %}
              <span class="was-price">
                {% if variant.price < variant.compare_at_price and variant.available %}
                  <span class="money">{{ variant.compare_at_price | money }}</span>
                {% endif %}
              </span>
  
              {% comment %} Size chart {% endcomment %}
              {% if product_tags contains 'meta-size-chart-' %}
                {% for tag in product.tags %}
                  {% if tag contains 'meta-size-chart-' %}
                    <a href="javascript:;" class="product__size-chart" data-fancybox data-src="#size-chart{{product.id}}" data-type="inline">{{ 'products.product.size_chart' | t }} {% include settings.icon, name: 'right-caret' %}</a>
                    {% include 'popup-size-chart', product_id: product.id %}
                  {% endif %}
                {% endfor %}
              {% elsif settings.size_chart != blank %}
                <a href="javascript:;" class="product__size-chart" data-fancybox data-src="#size-chart{{product.id}}" data-type="inline">{{ 'products.product.size_chart' | t }} {% include settings.icon, name: 'right-caret' %}</a>
                {% include 'popup-size-chart', product_id: product.id %}
              {% endif %}
  
              {% comment %} Savings {% endcomment %}
            {% endif %}
          </p>

          <div class="featured-product__images product__images">
            {% if section_onboarding %}
              {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg placeholder-svg--product' }}
            {% else %}
              {% include 'product__images' %}
            {% endif %}
          </div>
 
          <div class="featured-product__details has-product-sticker product__information">

            {% comment %} Sale sticker 
            {% if settings.stickers_enabled %}
              {% include 'product-thumbnail__sticker', context: 'product' %}
            {% endif %}
            {% endcomment %}

            {% if section_onboarding %}
  
              <div class="medium-down--hidden">
                <h2 class="product_name title">
                  <a href="{{ product.url }}">{{ 'homepage.onboarding.product_title' | t }}</a>
                </h2>
              </div>

              <div class="purchase-details">
                <div class="purchase-details__buttons purchase-details__spb--false">
                  <button name="add" class="action_button button button--add-to-cart add_to_cart" data-label={{ add_to_cart_label | json }}><span class="text">{{ 'products.product.add_to_cart' | t }}</span></button>
                </div>
              </div>

            {% else %}

              <h2 class="product-thumbnail__title title">
                {{ product.title }}
              </h2>

              {% unless collection_handles contains 'coming-soon' %}
                <div class="has-padding-top">
                  {% include 'product__notify-me-form' %}
                  {% include 'product__form' with 'product', type: 'product', page: 'monthly' %}
                </div>
              {% endunless %}

            {% endif %}
          </div>
        </div>
      </div>

  {% comment %} JavaScript {% endcomment %}
  <script
    type="application/json"
    data-section-id="{{ object.id }}"
    data-section-data
  >
    {
      "gallery_arrows": {{ object.settings.gallery_arrows | json }},
      "thumbnail_arrows": {{ object.settings.gallery_arrows | json }},
      "enable_zoom": {{ object.settings.enable_zoom | json }},
      "enable_product_lightbox": {{ object.settings.enable_product_lightbox | json }},
      "enable_thumbnail_slider": {{ object.settings.enable_thumbnail_slider | json }},
      "slideshow_speed": {{ object.settings.slideshow_speed | json }},
      "slideshow_transition": {{ object.settings.slideshow_transition | json }},
      "thumbnail_position": {{ object.settings.thumbnail_position | json }},
      "product_images_amount": {{ product.images.size }},
      "template": "featured-product-section"
    }
  </script>

<script data-theme-editor-load-script src="{{ 'z__jsMonthlyProductsList.js' | asset_url }}"></script>
