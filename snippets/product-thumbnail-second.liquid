{% comment %}
product-thumbnail.liquid
{% endcomment %}

{% if related_products == true %}
  {% assign hover_enabled = block.settings.show_related_products_title_on_hover %}
{% else %}
  {% assign hover_enabled = settings.thumbnail_hover_enabled %}
{% endif %}

{% if type == 'block' %}
  {% assign object = block %}
{% else %}
  {% assign object = section %}
{% endif %}

<div class="
  {% include 'column-width', value: products_per_row %}
  medium-down--one-half
  {% if object.settings.mobile_products_per_row == '1' %}
    small-down--one-whole
  {% else %}
    small-down--one-half
  {% endif %}
  column
  {% if settings.enable_quickshop %}
    quick-shop--true
    quick-shop--closed
    product-{{ product.id }} js-product_section
  {% endif %}
  {% if settings.stickers_enabled %}
    has-thumbnail-sticker
  {% endif %}
  thumbnail
  product__thumbnail
  product__grid-item
  thumbnail__hover-overlay--{{ hover_enabled }}
  "

  {% if section.settings.pagination_type != 'basic_pagination' %}
    data-load-more--grid-item
  {% endif %}>
  <div class="product-wrap {% if product.images[1] != blank and settings.show_secondary_image == true %}swap--true{% endif %}">

    {% assign collection_handles = product.collections | map: 'handle' %}
    {% if product.featured_image.alt contains 'youtube' or image.alt contains 'vimeo' %}
      {% assign alt_text = product.title %}
    {% else %}
      {% assign alt_text = product.featured_image.alt %}
    {% endif %}

    {% if type == 'block' %}
      {% assign image_crop = block.settings.image_crop %}
    {% else %}
      {% assign image_crop = section.settings.image_crop %}
    {% endif %}

    <div class="header-tag">
      {% if product.metafields.global.type != blank %}
        <span class="meta_product_type">{{ product.metafields.global.type }}</span>
      {% endif %}
      {% comment %}
      {% for tag in product.tags %}
        {% if tag contains 'meals' %}
          {% if  object.settings.enable_tooltip %}<div class="con-tooltip bottom">{% endif %}
            <a>{% include settings.icon, name: "icon-meal" %}{{ tag }}</a>
            {% if object.settings.enable_tooltip and object.settings.tooltip_text != blank %}
              <span class="tooltip-text purple">
                {{ object.settings.tooltip_text }}
              </span>
            </div>
            {% endif %}
        {% endif %}
      {% endfor %}
      {% endcomment %}
    </div>

    

    <div class="product-image__wrapper"> 
      <div class="image__container product__imageContainer">

        <a href="{{ product.url | within: collection }}">

          {% if settings.stickers_enabled %}
            {% include 'product-thumbnail__sticker' %}
          {% endif %}

          {% include 'image-element', image: product.featured_image, alt: alt_text, object_fit: align_height, max_height: height %}
          {% if product.images[1] != blank and settings.show_secondary_image == true %}
            <div class="image__container">
              <img src="{{ product.images[1] | img_url: '800x' }}"
              class="secondary swap--visible lazyload"
              alt="{{ alt_text | escape }}"
              />
            </div>
          {% endif %}
        </a>
      </div>

      {% if hover_enabled or settings.enable_quickshop %}
        <div class="thumbnail-overlay__container">
          <a class="hidden-product-link" href="{{ product.url | within: collection }}">{{ product.title }}</a>

          {% if hover_enabled %}
            <div class="quick-shop__info animated fadeInDown">
              <div class="thumbnail-overlay">
                <div class="info text-align-center">
                  {% if settings.display_vendor %}
                    <span class="product-thumbnail__vendor">{{ product.vendor }}</span>
                  {% endif %}

                  <p class="product-thumbnail__title highlight__text">{{ product.title }}</p>

                  {% if collection_handles contains 'coming-soon' %}
                    <span>{{ 'collections.general.coming_soon' | t }}</span>
                  {% else %}
                    <span class="product-thumbnail__price price {% comment %}{% if product.compare_at_price_max > product.price %}sale{% endif %}{% endcomment %}">
                      {% if product.available %}
                        {% if product.price_varies and product.price_min > 0 %}
                          <small><em>{{ 'products.general.from' | t }}</em></small>
                        {% endif %}
                        {% if product.price_min > 0 %}
                          <span class="money">{{ product.price_min | money }}</span>
                        {% else %}
                          {{ settings.free_price_text }}
                        {% endif %}
                        {% if product.compare_at_price_max > product.price %}
                          <span class="product-thumbnail__was-price was-price">
                            <span class="money">{{ product.compare_at_price_max | money }}</span>
                          </span>
                        {% endif %}
                      {% else %}
                        <span class="product-thumbnail__sold-out sold-out">{{ 'products.product.sold_out' | t }}</span>
                      {% endif %}
                    </span>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endif %}

          {% include 'product-thumbnail__quick-shop-button' %}

          {% if hover_enabled %}
            {% if settings.enable_shopify_collection_badges and settings.enable_shopify_review_comments %}
              <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
            {% endif %}
          {% endif %}
        </div>
      {% endif %}
    </div>

    <div class="thumbnail__caption text-align-{{ settings.thumbnail_text_alignment }}">
      {% include 'product-thumbnail__product-info' %}
      

      {% if collection_handles contains 'coming-soon' %}
        {% if settings.stickers_enabled == false %}
          {{ 'collections.general.coming_soon' | t }}
        {% endif %}
      {% else %} 
        <span class="product-thumbnail__price price {% comment %}{% if product.compare_at_price_max > product.price %}sale{% endif %}{% endcomment %}">
          {% if product.available %}
            {% if product.price_varies and product.price_min > 0 %}
              <small><em>{{ 'products.general.from' | t }}</em></small>
            {% endif %}
            {% if product.price_min > 0 %}
              <span class="money">{{ product.price_min | money }}</span>
            {% else %}
              {{ settings.free_price_text }}
            {% endif %}
            {% if product.compare_at_price_max > product.price %}
              <span class="product-thumbnail__was-price was-price">
                <span class="money">{{ product.compare_at_price_max | money }}</span>
              </span>
            {% endif %}
          {% else %}
            <span class="product-thumbnail__sold-out sold-out">{{ 'products.product.sold_out' | t }}</span>
          {% endif %}
        </span>
      {% endif %} 

      <div class="show_now_btn" data-shop-now>
        <a href="{{ product.url }}">{% if product.available %}Shop Now{% else %}Sold Out{% endif %}</a>
      </div>

      <div class="product-review__wrapper is-hidden-mobile-only">
        <div class="yotpo bottomLine"
          data-appkey="GjzCpbSqvmwwEWx7j6NiVgJL2xkIbFcgHLR48YC0"
          data-domain="{{shop.permanent_domain | escape }}"
          data-product-id="{{ product.id }}"
          data-product-models="{{ product.id }}"
          data-name="{{ product.title | escape }}"
          data-url="{{ shop.url }}{{ product.url }}"
          data-image-url="{{ product.featured_image | product_img_url: 'large' |replace: '?', '%3F' | replace: '&','%26'}}"
          data-description="{{ product.description | escape }}"
          data-bread-crumbs="{% for tag in product.tags %}{{ tag | escape }};{% endfor %}">
        </div>  
      </div>

    </div>

  </div>
  {% include 'product-thumbnail__swatch' %}

  {% if hover_enabled == false %}
    {% if settings.enable_shopify_collection_badges and settings.enable_shopify_review_comments %}
    {% endif %}
  {% endif %}

</div>
